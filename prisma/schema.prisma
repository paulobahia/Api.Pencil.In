generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Studio {
  id                   String                @id @default(uuid())
  name                 String
  address              String?
  phone                String?
  description          String?
  employees            Employee[]
  calendarIntegrations CalendarIntegration[]
  services             Service[]             @relation("StudioServices")
  User                 User[]
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  isDeleted            Boolean               @default(false)
  deletedAt            DateTime?
}

model Employee {
  id               String            @id @default(uuid())
  name             String
  email            String            @unique
  password         String
  studio           Studio            @relation(fields: [studioId], references: [id], onDelete: Cascade)
  studioId         String
  absences         Absence[]
  operatingHours   OperatingHour[]
  employeeServices EmployeeService[]
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  isDeleted        Boolean           @default(false)
  deletedAt        DateTime?
}

model OperatingHour {
  id            String                   @id @default(uuid())
  employee      Employee                 @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  employeeId    String
  dayOfWeek     DayOfWeek
  specificDate  DateTime?
  isAbsence     Boolean                  @default(false)
  timeIntervals TimeInterval[]
  isDefault     Boolean                  @default(false)
  exceptions    OperatingHourException[]
  createdAt     DateTime                 @default(now())
  updatedAt     DateTime                 @updatedAt
  isDeleted     Boolean                  @default(false)
  deletedAt     DateTime?
}

model OperatingHourException {
  id              String         @id @default(uuid())
  operatingHour   OperatingHour  @relation(fields: [operatingHourId], references: [id], onDelete: Cascade)
  operatingHourId String
  exceptionDate   DateTime
  timeIntervals   TimeInterval[]
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
}

model TimeInterval {
  id                       String                  @id @default(uuid())
  operatingHour            OperatingHour           @relation(fields: [operatingHourId], references: [id], onDelete: Cascade)
  operatingHourId          String
  OperatingHourException   OperatingHourException? @relation(fields: [operatingHourExceptionId], references: [id])
  operatingHourExceptionId String?
  startTime                DateTime
  endTime                  DateTime
  createdAt                DateTime                @default(now())
  updatedAt                DateTime                @updatedAt
  isDeleted                Boolean                 @default(false)
  deletedAt                DateTime?
}

model Service {
  id               String            @id @default(uuid())
  studio           Studio            @relation("StudioServices", fields: [studioId], references: [id], onDelete: Cascade)
  studioId         String
  name             String
  description      String?
  durationMinutes  Int
  price            Float
  schedulings      Scheduling[]
  employeeServices EmployeeService[]
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  isDeleted        Boolean           @default(false)
  deletedAt        DateTime?
}

model EmployeeService {
  id         String    @id @default(uuid())
  employeeId String
  serviceId  String
  employee   Employee  @relation(fields: [employeeId], references: [id])
  service    Service   @relation(fields: [serviceId], references: [id])
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  isDeleted  Boolean   @default(false)
  deletedAt  DateTime?
}

model User {
  id          String       @id @default(uuid())
  name        String
  phone       String       @unique
  studio      Studio       @relation(fields: [studioId], references: [id], onDelete: Cascade)
  studioId    String
  schedulings Scheduling[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  isDeleted   Boolean      @default(false)
  deletedAt   DateTime?
}

model Scheduling {
  id             String           @id @default(uuid())
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId         String
  service        Service          @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  serviceId      String
  schedulingTime DateTime
  status         SchedulingStatus
  notes          String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  isDeleted      Boolean          @default(false)
  deletedAt      DateTime?
}

model CalendarIntegration {
  id           String       @id @default(uuid())
  studio       Studio       @relation(fields: [studioId], references: [id], onDelete: Cascade)
  studioId     String
  calendarType CalendarType
  eventId      String
  status       String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @default(now())
  isDeleted    Boolean      @default(false)
  deletedAt    DateTime?
}

model Absence {
  id         String    @id @default(uuid())
  employee   Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  employeeId String
  date       DateTime
  reason     String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  isDeleted  Boolean   @default(false)
  deletedAt  DateTime?
}

enum DayOfWeek {
  SUNDAY
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
}

enum CalendarType {
  GOOGLE_CALENDAR
  OUTLOOK_CALENDAR
  APPLE_CALENDAR
  NOTION_CALENDAR
}

enum SchedulingStatus {
  PENDING
  CONFIRMED
  CANCELLED
}
